<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <script src="https://cdn.tailwindcss.com"></script>
    <title>Futbol Market | Profesyonel</title>
</head>
<body class="bg-[#0b0f1a] text-white font-sans">
    
    <div class="bg-red-900 py-2 overflow-hidden border-b border-red-700">
        <div class="whitespace-nowrap animate-marquee font-black uppercase text-[10px] tracking-widest text-red-100">
            {% for p in players if p.rumors %} ⚡ {{ p.name }}: {{ p.rumors }} &nbsp;&nbsp;&nbsp;&nbsp; {% endfor %}
        </div>
    </div>

    <div class="container mx-auto p-4 max-w-5xl">
        <div class="mb-6">
            <h2 class="text-blue-500 font-bold text-xs uppercase mb-3 italic">⚡ Son Hareketler</h2>
            <div id="latest-news-container" class="grid grid-cols-2 md:grid-cols-5 gap-3">
                </div>
        </div>

        <header class="py-8"><h1 class="text-2xl font-black italic text-blue-500 uppercase tracking-tighter">FUTBOL MARKET</h1></header>

        <div class="mb-8"><input type="text" id="src" onkeyup="filterAndSort()" placeholder="Ara..." class="w-full bg-[#161b2a] border border-slate-800 p-4 rounded-2xl outline-none text-sm"></div>

        <div id="grid" class="grid grid-cols-2 md:grid-cols-4 gap-6">
            {% for p in players %}
            <div class="card bg-[#161b2a] p-5 rounded-[2.5rem] border border-slate-800 hover:border-blue-500 transition shadow-xl" 
                 data-id="{{ p.id }}" data-info="{{ p.name|lower }} {{ p.club|lower }}" data-val="{{ p.value }}">
                <a href="/oyuncu/{{ p.id }}?sifre={{ sifre }}">
                    <div class="h-40 w-full mb-4 bg-[#0b0f1a] rounded-[2rem] flex justify-center items-center">
                        <img src="{{ p.img }}" class="h-full object-contain">
                    </div>
                    <h3 class="text-sm font-black text-center uppercase truncate">{{ p.name }}</h3>
                    <p class="text-slate-500 text-center text-[9px] uppercase">{{ p.club }}</p>
                    <div class="bg-blue-600/10 border border-blue-500/20 p-3 rounded-2xl text-center text-blue-400 font-black text-xs mt-3">{{ p.value }} M €</div>
                </a>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function syncFromStorage() {
            const players = JSON.parse(localStorage.getItem('players')) || [];
            
            // Kartları hafızaya göre düzelt
            players.forEach(p => {
                const card = document.querySelector(`.card[data-id="${p.id}"]`);
                if (card) {
                    card.querySelector('h3').innerText = p.name;
                    card.querySelector('p').innerText = p.club;
                    card.querySelector('.text-blue-400').innerText = p.marketValue + " M €";
                }
            });

            // Üst transfer bandını yap
            const container = document.getElementById('latest-news-container');
            if (container && players.length > 0) {
                const latest = [...players].slice(-5).reverse();
                container.innerHTML = latest.map(p => `
                    <div class="bg-slate-800/40 p-3 rounded-2xl border border-white/5">
                        <p class="text-[10px] font-black truncate text-white uppercase">${p.name}</p>
                        <p class="text-[8px] text-blue-400 font-bold truncate">➔ ${p.club}</p>
                    </div>
                `).join('');
            }
        }

        function filterAndSort() {
            let input = document.getElementById('src').value.toLowerCase();
            let grid = document.getElementById('grid');
            let cards = Array.from(grid.getElementsByClassName('card'));
            cards.forEach(card => card.style.display = card.dataset.info.includes(input) ? "block" : "none");
        }

        document.addEventListener('DOMContentLoaded', syncFromStorage);
    </script>
</body>
</html>
